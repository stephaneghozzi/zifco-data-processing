---
---

```{r}
config_file <- "config.yml"
config <- yaml::read_yaml(config_file)
load_functions <- sapply(
  list.files(
    "../deliverables-20230111/zifco-data-processing/R", 
    full.names = TRUE
  ), 
  \(x) source(x)
)
source("codebook.R")
```

```{r}
metadata_list <- load_metadata(config)
```

```{r}
codebook_table <- arrange_codebook_to_table(metadata_list$pia_codebook)
codebook_table <- add_question_id(codebook_table)
```

N.B.
- We discard `is_decimal` because it's weird and difficult to interpret: only there for integers ("Wie viele Tage ...").
- Unclear how to use `answer_type_id`: does it give the type of the answer, like integer, character etc.? can be any integer between 1 and 8, cf. `table(codebook_table$answer_type_id, useNA = "always")`
- `answer_level` is always = `answer_position`... keep both, but should be sorted when describing variables and checking which ones are necessary or useful
- I didn't treat multiple choices specifically, or, equivalently, answer conditions (e.g., `codebook[["Symptome Atemwege"]][["questions"]][[1]][["answer_options"]][[2]]` and `...[[3]]` both present if answer to main question was "Husten")

```{r}
# format of answer values and answer value codes
av_ans_raw <- sort(unique(dataset_list_raw$answers$Kodierung_Wert))
avc_ans_raw <- sort(unique(dataset_list_raw$answers$Kodierung_Code))
av_ansbu_raw <- sort(unique(dataset_list_raw$answers_backup$values))
avc_ansbu_raw <- sort(unique(dataset_list_raw$answers_backup$values_code))
av_cb <- sort(unique(codebook_table$answer_values))
avc_cb <- sort(unique(codebook_table$answer_values_code))

cat("-", paste(av_ans_raw, collapse = "\n- "),"\n")
cat("-", paste(avc_ans_raw, collapse = "\n- "),"\n")
cat("-", paste(av_ansbu_raw, collapse = "\n- "),"\n")
cat("-", paste(avc_ansbu_raw, collapse = "\n- "),"\n")
cat("-", paste(av_cb, collapse = "\n- "),"\n")
cat("-", paste(avc_cb, collapse = "\n- "),"\n")
```

